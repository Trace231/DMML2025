
dataset:
  type: voc  # Use Pascal VOC dataset
  root: data
  download: true
  year: "2012"
  image_size: 256
  batch_size: 6
  num_workers: 14
  augment: true
  train_ratio: 0.6
  val_ratio: 0.2
  sample_limit: 10000  # Limit total samples (train+val+test together). Set to null/empty to use all available samples.
  seed: 42   # 
  num_classes: 21  # Pascal VOC has 21 classes (0=background, 1-20=object classes)

evaluation:
  run_name: voc_benchmark
  output_dir:
  save_predictions: false

models:
  # ========== 特征 + CRF 模型 ==========
  - name: classical_crf
    builder: classical_crf
    params:
      config:
        sample_pixels: 10000  # 增加采样像素数，提高特征学习能力
        crf_iterations: 20  # 保持20次迭代，确保充分优化
        gaussian_sxy: 3
        bilateral_sxy: 50
        bilateral_srgb: 13
  
  # ========== CNN 模型 ==========
  - name: fcn_resnet50
    builder: fcn_resnet50
    params:
      pretrained: true
      finetune_epochs: 100
      learning_rate: 0.001  # Increased for better convergence (head LR=0.001, backbone LR=0.0001)
      batch_size: 12  # Increased from 4 to 8 for better GPU utilization on V100
      num_workers: 14
  - name: deeplabv3_resnet50
    builder: deeplabv3_resnet50
    params:
      pretrained: true
      finetune_epochs: 100
      learning_rate: 0.001  # Increased for better convergence (head LR=0.001, backbone LR=0.0001)
      batch_size: 12  # Increased from 4 to 8 for better GPU utilization on V100
      num_workers: 14
  # ========== Transformer 模型 ==========
  - name: segformer_b0
    builder: segformer_b0
    params:
      finetune_epochs: 100
      learning_rate: 0.00005
      batch_size: 12  # Increased from 4 to 8 for better GPU utilization on V100
      num_workers: 14
  
  # # ========== 扩散模型 ==========
  # - name: ddp
  #   builder: ddp
  #   params:
  #     finetune_epochs: 100
  #     learning_rate: 0.0001
  #     weight_decay: 1e-4
  #     batch_size: 8  # Smaller batch size for diffusion model
  #     num_workers: 14
  #     num_timesteps: 1000  # Training timesteps
  #     inference_steps: 50  # Inference timesteps (fewer for speed)
  #     base_channels: 64
  
  # # ========== 混合 CNN-Transformer 模型 ==========
  # - name: hybrid_unet_transformer
  #   builder: hybrid_unet_transformer
  #   params:
  #     base_channels: 32
  #     finetune_epochs: 100
  #     learning_rate: 0.001
  #     weight_decay: 1e-4
  #     batch_size: 12
  #     num_workers: 14
  
  # ========== CNN-CRF 端到端模型 ==========
  - name: cnn_crf_fcn
    builder: cnn_crf
    params:
      config:
        base_model: "fcn_resnet50"
        pretrained: true
        finetune_epochs: 100
        learning_rate: 0.001
        weight_decay: 1e-4
        batch_size: 12
        num_workers: 14
        crf_params:
          iterations: 5  # 保守设置：减少迭代次数，避免过度优化
          gaussian_sxy: 3
          bilateral_sxy: 30  # 保守设置：减小空间参数，适合256x256图像
          bilateral_srgb: 13
          compat_gaussian: 3
          compat_bilateral: 10
  
  - name: cnn_crf_deeplabv3
    builder: cnn_crf
    params:
      config:
        base_model: "deeplabv3_resnet50"
        pretrained: true
        finetune_epochs: 100
        learning_rate: 0.001
        weight_decay: 1e-4
        batch_size: 12
        num_workers: 14
        crf_params:
          iterations: 5  # 保守设置：减少迭代次数，避免过度优化
          gaussian_sxy: 3
          bilateral_sxy: 30  # 保守设置：减小空间参数，适合256x256图像
          bilateral_srgb: 13
          compat_gaussian: 3
          compat_bilateral: 10
  
  # ========== 任意模型 + CRF 后处理 ==========
  # CRF后处理评估 - 为所有模型添加CRF后处理版本
  # 注意：如果前面训练过相同配置的基础模型，会自动加载训练好的checkpoint
  - name: fcn_resnet50_crf_post
    builder: crf_wrapper
    params:
      base_builder: fcn_resnet50
      base_params:
        pretrained: true
        finetune_epochs: 0  # 如果找到训练好的checkpoint会自动使用，否则使用官方预训练权重
        learning_rate: 0.001
        batch_size: 12
        num_workers: 14
      crf_params:
        iterations: 20  # 增加到10次迭代，提高CRF优化效果
        gaussian_sxy: 3
        bilateral_sxy: 60  # 调整为60，更适合256x256图像
        bilateral_srgb: 13
        compat_gaussian: 3
        compat_bilateral: 10
  - name: deeplabv3_resnet50_crf_post
    builder: crf_wrapper
    params:
      base_builder: deeplabv3_resnet50
      base_params:
        pretrained: true
        finetune_epochs: 0  # 如果找到训练好的checkpoint会自动使用，否则使用官方预训练权重
        learning_rate: 0.001
        batch_size: 12
        num_workers: 14
      crf_params:
        iterations: 20  # 增加到10次迭代，提高CRF优化效果
        gaussian_sxy: 3
        bilateral_sxy: 60  # 调整为60，更适合256x256图像
        bilateral_srgb: 13
        compat_gaussian: 3
        compat_bilateral: 10
  - name: segformer_b0_crf_post
    builder: crf_wrapper
    params:
      base_builder: segformer_b0
      base_params:
        finetune_epochs: 0  # 如果找到训练好的checkpoint会自动使用，否则使用官方预训练权重
        learning_rate: 0.00005
        batch_size: 12
        num_workers: 14
      crf_params:
        iterations: 20  # 增加到10次迭代，提高CRF优化效果
        gaussian_sxy: 3
        bilateral_sxy: 60  # 调整为60，更适合256x256图像
        bilateral_srgb: 13
        compat_gaussian: 3
        compat_bilateral: 10
  # - name: hybrid_unet_transformer_crf_post
  #   builder: crf_wrapper
  #   params:
  #     base_builder: hybrid_unet_transformer
  #     base_params:
  #       base_channels: 32
  #       finetune_epochs: 0  # 如果找到训练好的checkpoint会自动使用
  #       learning_rate: 0.001
  #       weight_decay: 1e-4
  #       batch_size: 12
  #       num_workers: 14
  #     crf_params:
  #       iterations: 20  # 增加到10次迭代，提高CRF优化效果
  #       gaussian_sxy: 3
  #       bilateral_sxy: 60  # 调整为60，更适合256x256图像
  #       bilateral_srgb: 13
  #       compat_gaussian: 3
  #       compat_bilateral: 10
  # - name: ddp_crf_post
  #   builder: crf_wrapper
  #   params:
  #     base_builder: ddp
  #     base_params:
  #       finetune_epochs: 0  # 如果找到训练好的checkpoint会自动使用
  #       learning_rate: 0.0001
  #       weight_decay: 1e-4
  #       batch_size: 8
  #       num_workers: 14
  #       num_timesteps: 1000
  #       inference_steps: 50
  #       base_channels: 64
  #     crf_params:
  #       iterations: 20  # 增加到10次迭代，提高CRF优化效果
  #       gaussian_sxy: 3
  #       bilateral_sxy: 60  # 调整为60，更适合256x256图像
  #       bilateral_srgb: 13
  #       compat_gaussian: 3
  #       compat_bilateral: 10

